<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Chase Sapphire Checking</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<style>
/* =========================
   2030 NEON–GLASS THEME
   ========================= */
:root{
  --bg:#0a0a10;
  --panel:#0e0f17;
  --panel-2:#0b0c14;
  --text:#e9e8f7;
  --muted:#a7a6cc;
  --grid:rgba(140,140,200,.06);

  --violet:#8b5cf6;
  --violet-2:#7c3aed;
  --sky:#60a5fa;
  --pink:#ec4899;
  --green:#22c55e;
  --amber:#fbbf24;

  --glass: linear-gradient( to bottom right, rgba(18,18,30,.86), rgba(13,13,22,.86) ) padding-box,
           linear-gradient(135deg, var(--sky), var(--violet)) border-box;

  --elev: 0 22px 70px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.03);
  --elev-2: 0 26px 90px rgba(0,0,0,.6);
}

*{ box-sizing: border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: "Segoe UI", Roboto, system-ui, -apple-system, sans-serif;
  color:var(--text);
  background:var(--bg);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}

.fx{
  position:fixed; inset:0; z-index:-2; pointer-events:none;
  background:
    radial-gradient(900px 600px at 15% -10%, rgba(96,165,250,.22), transparent 60%),
    radial-gradient(900px 700px at 85% 120%, rgba(139,92,246,.18), transparent 60%),
    linear-gradient(180deg, #090911 0%, #0a0a12 60%, #090911 100%);
}
.fx::before,.fx::after{
  content:""; position:absolute; inset:-40%;
  background: conic-gradient(from 0turn, rgba(96,165,250,.12), rgba(124,58,237,.12), rgba(236,72,153,.12), rgba(96,165,250,.12));
  filter: blur(60px); animation: swirl 26s linear infinite;
}
.fx::after{ animation-duration: 34s; animation-direction: reverse; opacity:.6; }
@keyframes swirl{ to{ transform: rotate(1turn);} }

.grid{
  position:fixed; inset:0; z-index:-1; pointer-events:none;
  background:
    linear-gradient(transparent 79px, var(--grid) 80px),
    linear-gradient(90deg, transparent 79px, var(--grid) 80px);
  background-size:80px 80px;
  mask: radial-gradient(60% 60% at 50% 50%, #000 68%, transparent 100%);
}

/* Visibility */
.fade{ transition:opacity .4s ease; }
.hidden{ opacity:0; pointer-events:none; }
.visible{ opacity:1; pointer-events:auto; }

/* ---------- LOGIN ---------- */
#login-screen{
  position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
  padding:24px; z-index:9999;
}
.login-shell{
  width:min(480px, 94vw); border-radius:22px; padding:3px;
  background: linear-gradient(120deg, var(--sky), var(--violet), var(--sky));
  box-shadow: var(--elev-2), 0 0 120px rgba(96,165,250,.35);
}
#login-box{
  border-radius:20px; padding:28px 22px; text-align:center; color:#e8e7ef;
  background:#0b0b10; box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
}
.login-title{
  font-size: clamp(1.7rem, 5.8vw, 2.1rem); font-weight:800; letter-spacing:.3px; line-height:1.15;
  background: linear-gradient(90deg, var(--sky), #c084fc 45%, var(--sky));
  -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
  margin:2px 0 16px;
}
#login-error{ height:1.2em; margin-bottom:12px; color:#ff6b6b; opacity:0; transition:opacity .3s; }
.input-group{ position:relative; margin:12px 0; }
.input{
  width:100%; padding:14px 14px 14px 50px; border-radius:14px;
  background:#111223; border:1px solid #26263a; color:#e5e7eb; font-size:1rem;
  transition: border-color .2s, box-shadow .2s, background .2s;
}
.input::placeholder{ color:#9597b5; }
.input:focus{ outline:none; border-color:var(--sky); box-shadow:0 0 0 4px rgba(96,165,250,.22); background:#0f1020; }
.input-icon{ position:absolute; top:50%; left:14px; transform:translateY(-50%); width:22px; height:22px; opacity:.95; }

#login-btn{
  display:inline-flex; align-items:center; justify-content:center; gap:10px;
  margin-top:16px; padding:12px 16px; border-radius:14px; cursor:pointer;
  background:#0f0f18; color:#fff; font-weight:800; border:1px solid #2a2b36;
  transition: box-shadow .2s, border-color .2s, transform .05s, filter .2s;
}
#login-btn:hover,#login-btn:focus{ border-color:var(--sky); box-shadow:0 0 0 4px rgba(96,165,250,.18); outline:none; filter:saturate(1.06); }
#login-btn:active{ transform:translateY(1px); }
.btn-icon{ width:20px; height:20px; }

/* ---------- LAYOUT ---------- */
.container{ max-width:1100px; margin:22px auto 56px; padding:0 18px; }

.topbar{
  position:sticky; top:env(safe-area-inset-top); z-index:5; padding:12px 18px; backdrop-filter: blur(10px);
  background: linear-gradient( to right, rgba(12,12,22,.72), rgba(11,11,20,.58) );
  border-bottom:1px solid rgba(255,255,255,.06);
  display:flex; align-items:center; justify-content:space-between; gap:12px;
}
.brand{
  font-weight:900; letter-spacing:.3px;
  background: linear-gradient(90deg, var(--sky), var(--violet));
  -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
  font-size: clamp(1.15rem, 4.5vw, 1.55rem);
}
.top-actions{ display:flex; gap:10px; flex-wrap:wrap; }
.chip{
  padding:8px 12px; border-radius:999px; font-size:.9rem; color:#dfe3ff;
  background: linear-gradient(120deg, #121225, #0e0f18); border:1px solid rgba(255,255,255,.08);
}

/* Cards & buttons */
.card{
  border-radius:16px; padding:18px; background: var(--glass);
  border:2px solid transparent; color:var(--text);
  box-shadow: var(--elev); backdrop-filter: blur(10px);
  transition: transform .12s ease, box-shadow .25s ease, filter .25s ease, border-color .25s ease;
}
.card:hover{ transform: translateY(-2px); box-shadow: 0 28px 80px rgba(96,165,250,.28); filter: saturate(1.04); }
.card h4{ margin:0 0 10px; font-weight:800; color:#dfe2ff; }
.stat{ font-size: clamp(1.35rem, 5vw, 1.9rem); font-weight:900; letter-spacing:.2px; }
.stat-gradient{ background: linear-gradient(90deg, var(--sky), var(--violet)); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; }
.kv{ display:flex; justify-content:space-between; padding:10px 0; border-top:1px solid rgba(255,255,255,.07); }
.kv:first-child{ border-top:none; }
.muted{ color:var(--muted); }

/* Actions row */
.actions{ display:flex; flex-wrap:wrap; gap:12px; margin-top:12px; }
.action-btn, .primary-btn, .btn{
  display:inline-flex; align-items:center; gap:10px; padding:12px 14px; border-radius:12px; cursor:pointer;
  background: linear-gradient(#0f0f18,#0a0a14) padding-box,
              linear-gradient(135deg, var(--sky), var(--violet)) border-box;
  border:1px solid transparent; color:#fff; font-weight:800;
  transition: transform .06s, box-shadow .22s, filter .2s, background .2s;
  touch-action: manipulation;
}
.action-btn:hover,.primary-btn:hover,.btn:hover{ box-shadow: 0 14px 34px rgba(96,165,250,.35); filter:saturate(1.08); }
.action-btn:active,.primary-btn:active,.btn:active{ transform: translateY(1px); }
.action-btn svg,.primary-btn svg,.btn svg{ width:20px; height:20px; }

/* Secondary button (texty) */
.btn.secondary{
  background: linear-gradient(#101020,#0b0c14) padding-box,
              linear-gradient(135deg, rgba(255,255,255,.15), rgba(255,255,255,.06)) border-box;
  color:#e7e8fb; font-weight:700;
}

/* Overlay & modal base */
.overlay{
  position:fixed; inset:0; background:rgba(0,0,0,.48);
  opacity:0; pointer-events:none; transition:opacity .26s ease;
}
.overlay.visible{ opacity:1; pointer-events:auto; }
.modal{
  position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(.96);
  width:min(520px, 94vw); max-height:84vh; border-radius:16px; padding:18px;
  background: var(--glass); border:2px solid transparent; color:var(--text);
  box-shadow: var(--elev-2), inset 0 0 0 1px rgba(255,255,255,.03);
  backdrop-filter: blur(10px);
  opacity:0; pointer-events:none; transition:opacity .26s ease, transform .26s ease;
}
.modal.visible{ opacity:1; pointer-events:auto; transform:translate(-50%,-50%) scale(1); }
.modal h3{ margin:6px 0 10px; font-weight:800; }
.modal .close-btn{ position:absolute; top:8px; right:10px; font-size:1.3rem; background:none; border:none; color:var(--muted); cursor:pointer; }

/* Transactions list */
.transactions-list{ list-style:none; margin:8px 0 0; padding:0; max-height:56vh; overflow:auto; }
.transactions-list .date-header{ font-weight:700; color:#dfe2ff; margin:14px 0 6px; }
.tx-item{
  padding:12px; border-radius:12px; margin:10px 0; cursor:pointer;
  background: linear-gradient(#121222,#0f1020) padding-box,
              linear-gradient(135deg, rgba(96,165,250,.55), rgba(139,92,246,.55)) border-box;
  border:1px solid transparent; transition:filter .2s, transform .05s, box-shadow .2s;
}
.tx-item:hover{ filter:saturate(1.06); box-shadow: 0 10px 26px rgba(96,165,250,.28); }
.tx-summary{ display:flex; justify-content:space-between; gap:10px; }
.credit{ color:#22c55e; font-weight:800; }
.debit{ color:#f87171; font-weight:800; }

/* Search */
.search-wrap{
  display:flex; align-items:center; gap:10px;
  margin:10px 0 6px; padding:10px 12px; border-radius:12px;
  background: linear-gradient(#121222,#0f1020) padding-box,
              linear-gradient(135deg, rgba(96,165,250,.5), rgba(139,92,246,.5)) border-box;
  border:1px solid transparent;
}
.search-wrap svg{ width:18px; height:18px; opacity:.8; }
#tx-search{ flex:1; background:transparent; border:none; outline:none; color:var(--text); font-size:.98rem; padding:4px 0; }
#tx-clear{ background:none; border:none; color:var(--muted); cursor:pointer; font-size:1.1rem; line-height:1; padding:2px 6px; border-radius:8px; visibility:hidden; }
#tx-clear:hover{ color:#fff; }

/* Transfer modal */
.field{ display:grid; gap:8px; margin:8px 0; }
.field input, .field select{
  background:#111223; color:#e5e7eb; border:1px solid #26263a; border-radius:12px; padding:12px;
  outline:none; transition:border-color .2s, box-shadow .2s, background .2s;
}
.field input:focus, .field select:focus{ border-color:var(--violet); box-shadow:0 0 0 4px rgba(139,92,246,.22); background:#0f1020; }
.err{ color:#ff7b7b; font-size:.9rem; opacity:0; transform:translateY(-4px); transition:opacity .22s ease, transform .22s ease; }
.err.show{ opacity:1; transform:translateY(0); }

/* ---------- Pay Later (page + sheet) ---------- */
.paybar{ display:flex; align-items:center; gap:10px; }
.backlink{ color:#cdd1ff; text-decoration:none; font-weight:800; }
.pill{ padding:8px 14px; border-radius:999px; background:#121225; border:1px solid rgba(255,255,255,.08); color:#cfd2ff; }
.pot-header{ font-size: clamp(1.5rem, 6vw, 2.1rem); line-height:1.05; margin:16px 0 10px; }
.card.empty{ display:flex; align-items:center; justify-content:space-between; gap:14px; }
.primary-btn{ display:inline-flex; align-items:center; gap:10px; }

.sheet{
  position:fixed; left:0; right:0; bottom:0; z-index:9998;
  background: linear-gradient(180deg, rgba(13,13,22,.65), rgba(10,10,16,.8));
  transform: translateY(16px); opacity:0; pointer-events:none;
  transition: opacity .26s ease, transform .26s ease;
  border-top:1px solid rgba(255,255,255,.08);
  backdrop-filter: blur(12px);
}
.sheet.open{ opacity:1; transform: translateY(0); pointer-events:auto; }
.sheet-header{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px 16px; }
.sheet-scroll{ padding:0 16px 18px; max-height: calc(78vh - 44px); overflow:auto; }
.step{ display:none; opacity:0; transform: translateY(8px); transition: opacity .26s ease, transform .26s ease; }
.step.active{ display:block; opacity:1; transform: translateY(0); }

.actions-row{ display:flex; gap:10px; margin-top:10px; flex-wrap:wrap; }
.sticky-cta{
  position:sticky; bottom:0; display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:12px 12px; margin-top:12px; border-radius:14px; background:#121225; border:1px solid rgba(255,255,255,.08);
}
.sticky-cta.green{ background:#062912; border-color:#0d3b1f; }
.sticky-cta button{
  background:linear-gradient(#1eae5f,#148947) padding-box, linear-gradient(135deg,#2be477,#0ea463) border-box;
  border:1px solid transparent; color:#fff; font-weight:900; border-radius:12px; padding:10px 14px; display:inline-flex; align-items:center; gap:8px;
}
.sticky-cta button:disabled{ opacity:.55; filter:saturate(.6); cursor:not-allowed; }

.plan{
  border-radius:14px; padding:14px; margin:12px 0;
  background: linear-gradient(#121222,#0f1020) padding-box,
              linear-gradient(135deg, rgba(124,58,237,.45), rgba(236,72,153,.35)) border-box;
  border:1px solid transparent;
}
.plan .row{ display:flex; justify-content:space-between; align-items:center; gap:10px; }
.plan .muted{ margin-top:2px; }
.plan .schedule{ margin-top:10px; display:none; }
.plan .schedule.open{ display:block; }
.plan .sched-row{ display:flex; justify-content:space-between; padding:6px 0; border-top:1px dashed rgba(255,255,255,.08); }
.plan .sched-row:first-child{ border-top:none; }

.loader{ display:grid; place-items:center; gap:12px; padding:22px 0; }
.spinner{
  width:36px; height:36px; border-radius:50%;
  border:4px solid rgba(255,255,255,.15); border-top-color:#c1c5ff;
  animation: spin 1s linear infinite;
}
@keyframes spin{ to{ transform: rotate(360deg); } }

/* Virtual card */
.cc-card{
  width:min(520px, 100%); aspect-ratio:1.586; position:relative; border-radius:16px; padding:18px; cursor:pointer; overflow:hidden;
  background:
    radial-gradient(120% 140% at 0% 0%, rgba(96,165,250,.22), transparent 60%),
    radial-gradient(120% 140% at 100% 100%, rgba(236,72,153,.22), transparent 60%),
    linear-gradient(135deg, #101222, #0b0d18 55%, #0a0a14);
  border:1px solid rgba(255,255,255,.10);
  box-shadow: var(--elev);
}
.cc-card::after{
  content:""; position:absolute; inset:-40%;
  background: conic-gradient(from 0turn, rgba(96,165,250,.12), rgba(124,58,237,.12), rgba(236,72,153,.12), rgba(96,165,250,.12));
  filter: blur(48px); opacity:.28; animation: swirl 22s linear infinite;
}
.cc-name{ position:absolute; left:16px; top:14px; font-size:.78rem; letter-spacing:.22rem; font-weight:800; color:#c9c9ffb0; text-transform:uppercase; }
.cc-visa{ position:absolute; right:16px; bottom:12px; font-weight:900; letter-spacing:.04rem; font-size: clamp(1.1rem, 3.8vw, 1.6rem); color:#e9ecff; opacity:.92; text-shadow: 0 4px 18px rgba(139,92,246,.25); }
.cc-drawer{ overflow:hidden; border-radius:14px; margin-top:10px; background:#0f1020; border:1px solid rgba(255,255,255,.08); max-height:0; opacity:.7; transform: translateY(-4px); transition:max-height .28s ease, opacity .28s ease, transform .28s ease; }
.cc-drawer.open{ max-height:260px; opacity:1; transform: translateY(0); }
.cc-rows{ display:grid; grid-template-columns: 1fr 1fr; gap:10px 16px; padding:12px; }
.row-label{ color:var(--muted); font-size:.92rem; }

/* Mobile polish */
@media (max-width: 720px){
  .container{ margin:16px auto 42px; }
  .card{ padding:14px; }
  .actions{ gap:10px; }
  .action-btn, .primary-btn, .btn{ padding:11px 12px; }
  .transactions-list{ max-height: 55vh; }
  .sheet-scroll{ max-height: calc(78vh - 44px); }
}

/* Reduce motion */
@media (prefers-reduced-motion: reduce){
  .fade, .modal, .sheet, .step, .card, .action-btn, .btn{ transition:none !important; }
  .fx::before, .fx::after, .cc-card::after{ animation:none !important; }
}
</style>
</head>
<body>
  <div class="fx"></div>
  <div class="grid"></div>

  <!-- LOGIN -->
  <div id="login-screen" class="fade visible">
    <div class="login-shell">
      <div id="login-box">
        <h2 class="login-title">Welcome to Sapphire<br/>Checking</h2>

        <div id="login-error">Invalid credentials</div>

        <div class="input-group">
          <svg class="input-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="#60a5fa" d="M12 13.2a5.2 5.2 0 1 0 0-10.4 5.2 5.2 0 0 0 0 10.4Z"/>
            <path fill="#8b5cf6" d="M4.2 20.6c0-3.4 3.9-6.2 7.8-6.2s7.8 2.8 7.8 6.2v.2c0 .7-.6 1.2-1.3 1.2H5.5c-.7 0-1.3-.5-1.3-1.2v-.2Z"/>
          </svg>
          <input id="username" class="input" type="text" placeholder="Username" autocomplete="username" />
        </div>

        <div class="input-group">
          <svg class="input-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="#60a5fa" d="M17 9h-1V7a4 4 0 0 0-8 0v2H7a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2Zm-8-2a3 3 0 1 1 6 0v2H9V7Zm4 9.7V17a1 1 0 1 0-2 0v-.3a2 2 0 1 0 2 0Z"/>
          </svg>
          <input id="password" class="input" type="password" placeholder="Password" autocomplete="current-password" />
        </div>

        <button id="login-btn">
          <svg class="btn-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="#8b5cf6" d="M12 3a1 1 0 0 1 1 1v5h-2V5H6v14h5v-4h2v5a1 1 0 0 1-1 1H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7Zm8.7 9.3-4-4-1.4 1.4 1.3 1.3H12v2h4.6l-1.3 1.3 1.4 1.4 4-4a1 1 0 0 0 0-1.4Z"/>
          </svg>
          Log In
        </button>
      </div>
    </div>
  </div>

  <!-- APP ROOT -->
  <div id="app" class="fade hidden" aria-live="polite"></div>

  <!-- GLOBAL OVERLAY -->
  <div id="overlay" class="overlay"></div>

  <!-- ======= TRANSACTIONS MODAL ======= -->
  <div id="trans-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="tx-title">
    <button id="close-trans" class="close-btn" aria-label="Close">×</button>
    <h3 id="tx-title">Recent transactions</h3>

    <div class="search-wrap">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path fill="#60a5fa" d="M15.5 14h-.8l-.3-.3a6 6 0 1 0-.9.9l.3.3v.8L19 20.5 20.5 19 15.5 14Zm-6 0A4.5 4.5 0 1 1 14 9.5 4.5 4.5 0 0 1 9.5 14Z"/>
      </svg>
      <input id="tx-search" type="text" autocomplete="off" placeholder="Search merchant, amount, date…" />
      <button id="tx-clear" title="Clear">×</button>
    </div>

    <div class="date-header" style="color:var(--muted);">Pending (0)</div>
    <div style="margin-bottom:8px;color:var(--muted);">No pending transactions</div>

    <ul id="tx-list" class="transactions-list"></ul>
  </div>

  <!-- ======= TRANSFER MODAL ======= -->
  <div id="transfer-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="tr-title">
    <button id="close-transfer" class="close-btn" aria-label="Close">×</button>
    <h3 id="tr-title">Transfer funds</h3>
    <div class="field">
      <label>From</label>
      <select id="tr-from">
        <option selected>Sapphire Checking ••••2431</option>
      </select>
    </div>
    <div class="field">
      <label>To</label>
      <select id="tr-to">
        <option selected>External ••••9124</option>
        <option>External ••••6750</option>
      </select>
    </div>
    <div class="field">
      <label>Amount (whole dollars)</label>
      <input id="tr-amt" type="tel" inputmode="numeric" pattern="[0-9]*" placeholder="25" />
      <div id="tr-err" class="err">Enter a whole-dollar amount greater than 0 and not exceeding your balance.</div>
    </div>
    <div class="actions-row">
      <button id="tr-submit" class="btn">Send transfer</button>
    </div>
  </div>

<script>
/* ===== Helper utils ===== */
const $ = (sel,root=document)=>root.querySelector(sel);
const $$= (sel,root=document)=>[...root.querySelectorAll(sel)];
function mount(html, after){
  const app = document.getElementById('app');
  app.innerHTML = html;
  if (after) after(app);
}
function fmtMoney(n){ return n.toLocaleString(undefined,{style:'currency',currency:'USD'}); }
function todayStr(d=new Date()){ return (d.getMonth()+1)+"/"+d.getDate()+"/"+d.getFullYear(); }

/* ===== State (keeps your original transactions only) ===== */
let balance = 414.00;
const transactions = [
  { date:'Aug 18, 2025', merchant:'ACH transfer from TOTAL CHECKING (..6750)', amount:+64.00, type:'credit' },
  { date:'Aug 05, 2025', merchant:'Online Transfer from SAVINGS ****9124', amount:+350.00, type:'credit' }
];
const PL_LS_KEY = 'sapphire.paylater.plans.v1';

function getPlans(){
  try{ return JSON.parse(localStorage.getItem(PL_LS_KEY) || '[]'); }catch{ return []; }
}
function savePlans(plans){ localStorage.setItem(PL_LS_KEY, JSON.stringify(plans)); }

/* ===== LOGIN ===== */
document.addEventListener('DOMContentLoaded', () => {
  const overlay   = $('#overlay');
  const login     = $('#login-screen');
  const appRoot   = $('#app');
  const btn       = $('#login-btn');

  function tryLogin(){
    const u = $('#username').value.trim();
    const p = $('#password').value;
    const err = $('#login-error');
    if(u && p){
      login.classList.remove('visible');
      login.classList.add('hidden');
      setTimeout(()=>{ appRoot.classList.remove('hidden'); appRoot.classList.add('visible'); renderChecking(); }, 260);
    } else {
      err.textContent = 'Enter username & password';
      err.style.opacity = '1';
      setTimeout(()=> err.style.opacity = '0', 1600);
    }
  }
  btn.addEventListener('click', tryLogin);
  ['username','password'].forEach(id=>{
    document.getElementById(id).addEventListener('keydown', e => { if(e.key==='Enter') tryLogin(); });
  });

  /* ===== Checking page ===== */
  function renderChecking(){
    mount(`
      <div class="topbar">
        <div class="brand">Chase Sapphire Checking</div>
        <div class="top-actions">
          <div class="chip">Status: <strong>Active</strong></div>
          <div class="chip">Acct ••••2431</div>
        </div>
      </div>

      <div class="container">
        <div class="card">
          <h4>Available Balance</h4>
          <div id="bal" class="stat stat-gradient">${fmtMoney(balance)}</div>
          <div class="actions">
            <button id="show-trans" class="action-btn">
              <svg viewBox="0 0 24 24"><path fill="#60a5fa" d="M3 5h18a2 2 0 0 1 2 2v2H1V7a2 2 0 0 1 2-2Zm-2 7h22v5a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-5Zm4 3v2h6v-2H5Z"/></svg>
              Recent
            </button>
            <button id="transfer" class="action-btn">
              <svg viewBox="0 0 24 24"><path fill="#a78bfa" d="M4 7h9V4l5 5-5 5v-3H4zM20 17H11v3l-5-5 5-5v3h9z"/></svg>
              Transfer
            </button>
            <button id="paylater" class="action-btn">
              <svg viewBox="0 0 24 24"><path fill="#34d399" d="M12 22a9 9 0 1 1 9-9 9.01 9.01 0 0 1-9 9Zm1-9.6 3.5-3.5 1.4 1.4L12 16l-3.9-3.9 1.4-1.4L13 12.4V6h2v6.4Z"/></svg>
              Pay later
            </button>
          </div>
        </div>

        <div class="card">
          <h4>Account Snapshot</h4>
          <div class="kv"><span class="muted">Present balance</span><strong id="present">${fmtMoney(balance)}</strong></div>
          <div class="kv"><span class="muted">Account number</span><strong>501262431</strong></div>
          <div class="kv"><span class="muted">Routing number</span><strong>072000326</strong></div>
        </div>
      </div>
    `, (app)=>{
      /* Recent transactions modal */
      $('#show-trans',app).onclick = () => {
        openModal('trans-modal');
        renderTxList(filterTx($('#tx-search').value));
        setTimeout(()=> $('#tx-search').focus(), 40);
      };
      $('#close-trans').onclick = () => closeModal('trans-modal');

      /* Transfer modal (real, updates balance & tx list) */
      $('#transfer',app).onclick = () => {
        $('#tr-amt').value = '';
        $('#tr-err').classList.remove('show');
        openModal('transfer-modal');
        setTimeout(()=> $('#tr-amt').focus(), 40);
      };
      $('#close-transfer').onclick = () => closeModal('transfer-modal');
      $('#tr-amt').addEventListener('input', (e)=>{
        e.target.value = e.target.value.replace(/\D/g,''); // only digits
      });
      $('#tr-submit').onclick = () => {
        const raw = $('#tr-amt').value.trim();
        const amt = Number(raw);
        const err = $('#tr-err');
        if(!amt || amt<=0 || !Number.isFinite(amt) || !Number.isInteger(amt) || amt>balance){
          err.classList.add('show');
          return;
        }
        err.classList.remove('show');
        balance = +(balance - amt).toFixed(2);
        $('#bal').textContent = fmtMoney(balance);
        $('#present').textContent = fmtMoney(balance);

        // push a new transaction entry
        transactions.unshift({
          date: todayStr(new Date()),
          merchant: `Transfer to ${$('#tr-to').value}`,
          amount: -amt,
          type: 'debit'
        });
        closeModal('transfer-modal');
      };

      /* Pay later */
      $('#paylater',app).onclick = () => renderPayLater();
    });
  }

  /* ===== Pay Later page & flow ===== */
  function renderPayLater(){
    const plans = getPlans();
    const count = plans.length;
    mount(`
      <div class="topbar paybar">
        <a href="#" id="backChecking" class="backlink">← Checking</a>
        <div class="pill">Active plans: <strong id="planCount" style="margin-left:6px">${count}</strong></div>
      </div>

      <div class="container" id="potContainer">
        <h1 class="pot-header">Pay over<br/>time</h1>

        ${ count ? renderPlansList(plans) : `
          <div class="card empty" id="emptyState">
            <div class="muted">No active plans</div>
            <button class="primary-btn startPlan">
              <svg viewBox="0 0 24 24"><path fill="#c4c8ff" d="M11 11V6h2v5h5v2h-5v5h-2v-5H6v-2z"/></svg>
              Plan a purchase
            </button>
          </div>
        `}
      </div>

      <!-- bottom sheet -->
      <div id="sheet" class="sheet" aria-hidden="true">
        <div class="sheet-header">
          <div style="font-weight:900">Plan a purchase</div>
          <button class="close-btn" id="closeSheet" aria-label="Close">×</button>
        </div>
        <div class="sheet-scroll">
          <!-- Step 1 -->
          <div class="step active" id="step1">
            <div class="field">
              <label>Store name</label>
              <input id="storeInput" type="text" inputmode="text" autocomplete="off" placeholder="e.g., Best Buy">
              <div id="err1" class="err">Please enter a store name.</div>
            </div>
            <div class="actions-row"><button id="s1Next" class="btn">Continue</button></div>
          </div>

          <!-- Step 2 -->
          <div class="step" id="step2">
            <div class="field">
              <label>Purchase amount (minimum $50)</label>
              <input id="amountInput" type="tel" inputmode="numeric" pattern="[0-9]*" placeholder="50">
              <div id="err2" class="err">Enter a whole dollar amount of $50 or more.</div>
            </div>
            <div class="actions-row"><button id="back1" class="btn secondary">Back</button><button id="s2Next" class="btn">Continue</button></div>
          </div>

          <!-- Loading -->
          <div class="step" id="loadingStep">
            <div class="loader"><div class="spinner"></div><div>Retrieving plans…</div></div>
          </div>

          <!-- Plans -->
          <div class="step" id="plansStep">
            <div id="plansWrap"></div>
            <label style="display:flex;align-items:center;gap:8px;margin-top:10px">
              <input id="agree" type="checkbox"><span>I agree to the loan terms and the Truth in Lending disclosure.</span>
            </label>
            <div class="sticky-cta green">
              <div class="muted" id="ctaHint">Select a plan to continue.</div>
              <button id="activateBtn" disabled>
                <svg viewBox="0 0 24 24"><path fill="#fff" d="M10 17l-4-4 1.4-1.4L10 14.2l6.6-6.6L18 9l-8 8z"/></svg>
                Activate plan
              </button>
            </div>
            <div class="actions-row" style="margin-top:8px"><button id="back2" class="btn secondary">Back</button></div>
          </div>

          <!-- Activating -->
          <div class="step" id="activatingStep">
            <div class="loader"><div class="spinner"></div><div>Activating plan…</div></div>
          </div>

          <!-- Virtual card -->
          <div class="step" id="cardStep">
            <div class="muted" id="cardMsg" style="margin-bottom:8px"></div>
            <div id="vcard" class="cc-card" role="button" title="Tap to reveal details">
              <div class="cc-name">SAPPHIRE • VIRTUAL</div><div class="cc-visa">VISA</div>
            </div>
            <div id="ccDrawer" class="cc-drawer">
              <div class="cc-rows">
                <div class="row-label">Card number</div><div id="ccNum"></div>
                <div class="row-label">Expiry</div><div id="ccExp"></div>
                <div class="row-label">Security</div><div id="ccCvv"></div>
              </div>
            </div>
            <div class="actions-row"><button id="finish" class="btn">Done</button></div>
          </div>
        </div>
      </div>
    `, (app)=>{
      $('#backChecking',app).onclick = (e)=>{ e.preventDefault(); renderChecking(); };

      const sheet = $('#sheet',app);
      const overlay = $('#overlay');

      // open/close sheet helpers
      const openSheet = ()=>{
        // reset steps every time it's opened
        $$('.step', sheet).forEach(s=>s.classList.remove('active'));
        $('#step1',sheet).classList.add('active');
        $('#storeInput',sheet).value='';
        $('#amountInput',sheet).value='';
        $('#err1',sheet).classList.remove('show');
        $('#err2',sheet).classList.remove('show');
        $('#plansWrap',sheet).innerHTML='';
        $('#agree',sheet).checked=false;
        $('#activateBtn',sheet).disabled=true;
        $('#ctaHint',sheet).textContent='Select a plan to continue.';
        overlay.classList.add('visible');
        sheet.classList.add('open');
        sheet.setAttribute('aria-hidden','false');
      };
      const closeSheet= ()=>{
        sheet.classList.remove('open');
        overlay.classList.remove('visible');
        sheet.setAttribute('aria-hidden','true');
      };

      // Event delegation keeps button working even after re-render
      app.addEventListener('click',(e)=>{
        if(e.target.closest('.startPlan')){ openSheet(); }
      });
      $('#closeSheet',sheet).onclick = closeSheet;
      overlay.addEventListener('click', ()=> {
        // close only if a modal/sheet is open
        if(sheet.classList.contains('open')) closeSheet();
      });

      // Step machine
      const go = id=>{
        $$('.step',sheet).forEach(s=>s.classList.remove('active'));
        $(id, sheet).classList.add('active');
      };

      // Step 1 -> 2
      $('#s1Next',sheet).onclick = ()=>{
        const v = $('#storeInput',sheet).value.trim();
        if(!v){ $('#err1',sheet).classList.add('show'); return; }
        $('#err1',sheet).classList.remove('show');
        go('#step2');
        setTimeout(()=> $('#amountInput',sheet).focus(), 40);
      };

      // numeric only (no cents)
      $('#amountInput',sheet).addEventListener('input', (e)=>{
        e.target.value = e.target.value.replace(/\D/g,''); // only digits
      });

      // Step 2 -> Loading / Validate amount
      $('#s2Next',sheet).onclick = ()=>{
        const raw = $('#amountInput',sheet).value.trim();
        const num = Number(raw);
        if(!raw || !Number.isInteger(num) || num<50){
          $('#err2',sheet).classList.add('show');
          return;
        }
        $('#err2',sheet).classList.remove('show');
        go('#loadingStep');
        setTimeout(()=>{ // fake 4s fetch
          const plans = buildPlans(num);
          renderSelectablePlans(plans, sheet);
          go('#plansStep');
        }, 4000);
      };

      $('#back1',sheet).onclick = ()=> go('#step1');
      $('#back2',sheet).onclick = ()=> go('#step2');

      // Activate flow -> Activating -> Card
      $('#activateBtn',sheet).onclick = ()=>{
        go('#activatingStep');
        setTimeout(()=>{
          const chosen = $('#plansWrap',sheet).querySelector('input[name="planOpt"]:checked');
          if(!chosen) return;
          const plan = JSON.parse(chosen.value);
          // Generate virtual card
          const card = makeVirtualCard();
          $('#cardMsg',sheet).textContent = `Virtual card for ${fmtMoney(plan.total)} at ${$('#storeInput',sheet).value.trim()}`;
          $('#ccNum',sheet).textContent = card.number;
          $('#ccExp',sheet).textContent = card.exp;
          $('#ccCvv',sheet).textContent = card.cvv;

          go('#cardStep');

          // Save plan
          const now = new Date();
          const saved = getPlans();
          saved.unshift({
            created: now.toLocaleString(),
            store: $('#storeInput',sheet).value.trim(),
            total: plan.total,
            schedule: plan.schedule
          });
          savePlans(saved);
          // Update count pill
          $('#planCount') && ($('#planCount').textContent = String(saved.length));

          // vcard interactions
          const vcard = $('#vcard',sheet);
          const drawer= $('#ccDrawer',sheet);
          vcard.onclick = ()=> drawer.classList.toggle('open');
          $('#finish',sheet).onclick = ()=>{
            closeSheet();
            // Re-render page to show active plan card list
            renderPayLater();
          };
        }, 5000);
      };

      // Agree terms: enable button if plan chosen
      $('#agree',sheet).addEventListener('change', ()=>{
        const chosen = $('#plansWrap',sheet).querySelector('input[name="planOpt"]:checked');
        $('#activateBtn',sheet).disabled = !(chosen && $('#agree',sheet).checked);
      });
    });
  }

  /* ===== Utilities for Pay Later ===== */
  function renderPlansList(plans){
    // Simple list of active plans with created timestamp and schedule
    const items = plans.map(p => `
      <div class="card">
        <div class="kv"><span class="muted">Created</span><strong>${p.created}</strong></div>
        <div class="kv"><span class="muted">Store</span><strong>${p.store}</strong></div>
        <div class="kv"><span class="muted">Total</span><strong>${fmtMoney(p.total)}</strong></div>
        <h4 style="margin-top:8px">Schedule</h4>
        ${p.schedule.map((s,i)=>`
          <div class="kv"><span class="muted">${i===0 ? 'Downpayment' : 'Payment '+i}</span><strong>${s.date} • ${fmtMoney(s.amount)}</strong></div>
        `).join('')}
      </div>
    `).join('');
    return items + `
      <div class="card empty">
        <div class="muted">Start another plan</div>
        <button class="primary-btn startPlan">
          <svg viewBox="0 0 24 24"><path fill="#c4c8ff" d="M11 11V6h2v5h5v2h-5v5h-2v-5H6v-2z"/></svg>
          Plan a purchase
        </button>
      </div>`;
  }

  function buildPlans(total){
    const plans = [];
    // Bi-weekly: 4 payments (downpayment + 3 biweekly)
    const biweeklyAmt = +(total/4).toFixed(2);
    const biweeklySched = [];
    let d = new Date(); // downpayment today
    biweeklySched.push({ date: todayStr(d) + ' (downpayment)', amount: biweeklyAmt });
    for(let i=1;i<4;i++){
      const nd = new Date(d);
      nd.setDate(nd.getDate()+14*i);
      biweeklySched.push({ date: todayStr(nd), amount: biweeklyAmt });
    }
    plans.push({ key:'biweekly', label:'Bi-weekly', sub:'4 payments (first due today as downpayment)', payment:biweeklyAmt, first:biweeklySched[0].date, schedule:biweeklySched, total });

    // 6 months: equal monthly, first due next month same day
    const m6Amt = +(total/6).toFixed(2);
    const sched6 = [];
    const s0 = new Date(); s0.setMonth(s0.getMonth()+1);
    for(let i=0;i<6;i++){
      const nd = new Date(s0); nd.setMonth(s0.getMonth()+i);
      sched6.push({ date: todayStr(nd), amount: m6Amt });
    }
    plans.push({ key:'6m', label:'6 months', sub:'Equal monthly payments', payment:m6Amt, first:sched6[0].date, schedule:sched6, total });

    if(total>100){
      const m12Amt = +(total/12).toFixed(2);
      const sched12=[];
      const s1 = new Date(); s1.setMonth(s1.getMonth()+1);
      for(let i=0;i<12;i++){
        const nd = new Date(s1); nd.setMonth(s1.getMonth()+i);
        sched12.push({ date: todayStr(nd), amount: m12Amt });
      }
      plans.push({ key:'12m', label:'12 months', sub:'Lower monthly payments', payment:m12Amt, first:sched12[0].date, schedule:sched12, total });
    }
    return plans;
  }

  function renderSelectablePlans(plans, sheet){
    const wrap = $('#plansWrap',sheet);
    wrap.innerHTML = plans.map((p,idx)=>`
      <label class="plan">
        <div class="row">
          <div>
            <div style="font-weight:900; font-size:1.02rem">${p.label}</div>
            <div class="muted">${p.sub}</div>
          </div>
          <input type="radio" name="planOpt" ${idx===0?'checked':''}
            value='${JSON.stringify(p)}' />
        </div>
        <div class="kv"><span class="muted">Payment</span><strong>${fmtMoney(p.payment)} ${p.key==='biweekly'?'/ bi-weekly':'/ month'}</strong></div>
        <div class="kv"><span class="muted">First due</span><strong>${p.first}</strong></div>
        <div style="margin-top:8px">
          <button type="button" class="btn secondary viewSchedule">View schedule</button>
        </div>
        <div class="schedule">
          ${p.schedule.map((s,i)=>`<div class="sched-row"><span>${i===0?'Downpayment':'Payment '+(i)}</span><span>${s.date} • ${fmtMoney(s.amount)}</span></div>`).join('')}
        </div>
      </label>
    `).join('');

    // enable/disable activate
    const updateActivate = ()=>{
      const chosen = wrap.querySelector('input[name="planOpt"]:checked');
      const agree  = $('#agree',sheet).checked;
      $('#activateBtn',sheet).disabled = !(chosen && agree);
      $('#ctaHint',sheet).textContent = chosen ? (agree?'Ready to activate.':'Please agree to the terms.') : 'Select a plan to continue.';
    };
    wrap.addEventListener('change', (e)=>{
      if(e.target.name==='planOpt'){ updateActivate(); }
    });
    $('#agree',sheet).addEventListener('change', updateActivate);
    updateActivate();

    // view schedule toggles
    wrap.addEventListener('click', (e)=>{
      if(e.target.closest('.viewSchedule')){
        const box = e.target.closest('.plan').querySelector('.schedule');
        box.classList.toggle('open');
      }
    });
  }

  function makeVirtualCard(){
    // random 16-digit, group 4s
    const digits = Array.from({length:16}, ()=> Math.floor(Math.random()*10)).join('');
    const groups = digits.match(/.{1,4}/g).join(' ');
    // expiry: 3 years ahead, random month
    const now = new Date();
    const month = String(Math.floor(Math.random()*12)+1).padStart(2,'0');
    const year  = (now.getFullYear()+3).toString().slice(-2);
    const cvv   = String(Math.floor(100+Math.random()*900));
    return { number:groups, exp: `${month}/${year}`, cvv };
  }

  /* ===== Modals & Transactions ===== */
  function openModal(id){ $('#overlay').classList.add('visible'); const m = document.getElementById(id); m.classList.add('visible'); }
  function closeModal(id){ $('#overlay').classList.remove('visible'); const m = document.getElementById(id); m.classList.remove('visible'); }

  const txListEl = $('#tx-list');
  function renderTxList(list = transactions){
    txListEl.innerHTML = '';
    if (!list.length){
      txListEl.innerHTML = '<li class="muted" style="padding:12px 6px;">No matches.</li>';
      return;
    }
    const byDate = {};
    list.forEach(t => { (byDate[t.date] ??= []).push(t); });
    Object.entries(byDate).forEach(([date, items])=>{
      const header = document.createElement('div');
      header.className = 'date-header';
      header.textContent = `${date} (${items.length})`;
      txListEl.appendChild(header);

      items.forEach(tx => {
        const li = document.createElement('li');
        li.className = 'tx-item';
        const amt = (tx.amount >= 0 ? '+' : '-') + fmtMoney(Math.abs(tx.amount)).replace('$','');
        li.innerHTML = `
          <div class="tx-summary">
            <span>${tx.merchant}</span>
            <span class="${tx.amount >= 0 ? 'credit' : 'debit'}">$${amt}</span>
          </div>
        `;
        txListEl.appendChild(li);
      });
    });
  }

  // search
  const searchInput = $('#tx-search');
  const clearBtn    = $('#tx-clear');
  function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }
  function filterTx(q){
    if(!q) return transactions;
    const tokens = q.trim().toLowerCase().split(/\s+/).map(escapeRegExp);
    return transactions.filter(tx => {
      const hay = `${tx.merchant} ${tx.date} ${tx.amount.toFixed(2)} ${tx.type}`.toLowerCase();
      return tokens.every(t => new RegExp(`(^|\\b|\\s)${t}`).test(hay));
    });
  }
  searchInput.addEventListener('input', () => {
    const q = searchInput.value;
    renderTxList(filterTx(q));
    clearBtn.style.visibility = q ? 'visible' : 'hidden';
  });
  clearBtn.addEventListener('click', () => {
    searchInput.value = '';
    renderTxList(transactions);
    clearBtn.style.visibility = 'hidden';
    searchInput.focus();
  });

  // expose for back button etc.
  window.renderChecking = renderChecking;
  window.renderPayLater = renderPayLater;
});
</script>
</body>
</html>
